<%- headers = ['Id',
               'Resource Type',
               'Visibility',
               'DOI',
               'Depositor',
               'Authors',
               'Contributors',
               'Title',
               'Abstract',
               'Create Date',
               'Modified Date',
               'Published Date',
               'Notes',
               'Admin Notes',
               'Rights',
               'Keywords',
               'Language',
               'Publisher',
               'Related Links',
               'Sponsoring Agency',
               'Source',
               'Views',
               'Downloads',
               'File Count',
               'Total Size'
              ] -%>
<%= CSV.generate_line headers %>
<%- @works.each do |rec| -%>
   <%= raw( CSV.generate_line( [ rec.id,
                                 rec.resource_type,
                                 format_visibility( rec ),
                                 rec.doi,
                                 rec.depositor,
                                 format_persons( rec.authors ),
                                 format_persons( rec.contributors ),
                                 format_array( rec.title, ' ' ),
                                 rec.abstract,
                                 rec.date_created,
                                 rec.modified_date,
                                 rec.published_date,
                                 rec.notes,
                                 format_array( rec.admin_notes, ', ' ),
                                 format_array( rec.rights, ' ' ),
                                 format_array( rec.keyword, ', ' ),
                                 format_array( rec.language, ', ' ),
                                 rec.publisher,
                                 format_array( rec.related_url, ', ' ),
                                 format_array( rec.sponsoring_agency, ', ' ),
                                 rec.work_source,
                                 get_work_view_count( rec ),
                                 get_work_download_count( rec ),
                                 rec.file_sets.length,
                                 get_work_aggregate_size( rec )
                          ]) ) -%>
<%- end -%>
