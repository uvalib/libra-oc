<%- headers = ['Id',
               'Resource Type',
               'Visibility',
               'DOI',
               'Depositor',
               'Depositor ORCiD',
               'Authors',
               'Contributors',
               'Title',
               'Abstract',
               'Create Date',
               'Modified Date',
               'Published Date',
               'Notes',
               'Admin Notes',
               'Rights',
               'Keywords',
               'Language',
               'Publisher',
               'Related Links',
               'Sponsoring Agency',
               'Source',
               'Views',
               'Downloads',
               'File Count',
               'Total Size'] -%>
<%= CSV.generate_line headers %>
<%- @works.each do |rec| -%>
   <%= raw( CSV.generate_line( [rec.id,
                                first_from_array( rec.resource_type ),
                                format_visibility( rec ),
                                first_from_array( rec.doi ),
                                rec.depositor,
                                rec.author_orcid_url,
                                format_array( rec.authors_display, ', ' ),
                                format_array( rec.contributors_display, ', ' ),
                                format_array( rec.title, ' ' ),
                                format_abstract( rec ),
                                first_from_array( rec.date_created ),
                                rec.date_modified,
                                first_from_array( rec.published_date ),
                                format_notes( rec ),
                                format_admin_notes( rec ),
                                first_from_array( rec.rights_display ),
                                format_array( rec.keyword, ', ' ),
                                format_array( rec.language, ', ' ),
                                first_from_array( rec.publisher ),
                                format_array( rec.related_url, ', ' ),
                                format_array( rec.sponsoring_agency, ', ' ),
                                first_from_array( rec.work_source ),
                                format_view_count( rec ),
                                format_download_count( rec ),
                                format_file_count( rec ),
                                format_aggregate_filesize( rec )]) ) -%>
<%- end -%>
