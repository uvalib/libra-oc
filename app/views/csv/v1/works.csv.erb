<%- headers = ['Id',
               'Resource Type',
               'Visibility',
               'DOI',
               'Depositor',
               'Authors',
               'Contributors',
               'Title',
               'Abstract',
               'Create Date',
               'Modified Date',
               'Published Date',
               'Notes',
               'Admin Notes',
               'Rights',
               'Keywords',
               'Language',
               'Publisher',
               'Related Links',
               'Sponsoring Agency',
               'Source',
               'Views',
               'Downloads',
               'File Count',
               'Total Size'
              ] -%>
<%= CSV.generate_line headers %>
<%- @works.each do |rec| -%>
   <%= raw( CSV.generate_line( [ rec.id,
                                 rec.resource_type.first,
                                 format_visibility( rec ),
                                 rec.doi.first,
                                 rec.depositor,
                                 format_array( rec.authors_display, ', ' ),
                                 format_array( rec.contributors_display, ', ' ),
                                 format_array( rec.title, ' ' ),
                                 format_array( rec.abstract, ' ' ),
                                 rec.date_created.first,
                                 rec.date_modified,
                                 rec.published_date.first,
                                 rec.notes,
                                 format_array( rec.admin_notes, ', ' ).gsub( LibraWork::ADMIN_NOTE_DATE_MARKER, '-' ),
                                 rec.rights.first,
                                 format_array( rec.keyword, ', ' ),
                                 format_array( rec.language, ', ' ),
                                 rec.publisher.first,
                                 format_array( rec.related_url, ', ' ),
                                 format_array( rec.sponsoring_agency, ', ' ),
                                 rec.work_source.first,
                                 format_view_count( rec ),
                                 format_download_count( rec ),
                                 format_file_count( rec ),
                                 format_aggregate_filesize( rec )
                          ]) ) -%>
<%- end -%>
