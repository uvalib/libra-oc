<%- headers = ['Id',
               'Resource Type',
               'DOI',
               'Depositor',
               'Authors',
               'Contributors',
               'Title',
               'Abstract',
               'Create Date',
               'Modified Date',
               'Published Date',
               'Notes',
               'Admin Notes',
               'Rights',
               'Keywords',
               'Language',
               'Publisher',
               'Related Links',
               'Sponsoring Agency',
               'Source',
               'Views',
               'Downloads',
               'File Count',
               'Total Size'
              ] -%>
<%= CSV.generate_line headers %>
<%- @works.each do |rec| -%>
   <%= raw( CSV.generate_line( [ rec.id,
                                 rec.resource_type,
                                 rec.doi,
                                 rec.depositor,
                                 format_persons( rec.authors ),
                                 format_persons( rec.contributors ),
                                 rec.title.join( ' ' ),
                                 rec.abstract,
                                 rec.date_created,
                                 rec.modified_date,
                                 rec.published_date,
                                 rec.notes,
                                 rec.admin_notes.join( ' ' ),
                                 rec.rights.join( ' ' ),
                                 rec.keyword.join( ', ' ),
                                 rec.language.join( ', ' ),
                                 rec.publisher,
                                 rec.related_url.join( ', ' ),
                                 rec.sponsoring_agency.join( ', ' ),
                                 rec.work_source,
                                 get_work_view_count( rec ),
                                 get_work_download_count( rec ),
                                 rec.file_sets.length,
                                 get_work_aggregate_size( rec )
                          ] ) ) -%>
<%- end -%>